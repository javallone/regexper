var Canopy={};Canopy.extend=function(b,a){if(!b||!a)return b;for(var d in a){if(b[d]!==a[d])b[d]=a[d]}return b};Canopy.extend(Canopy,{compile:function(b){var a=new this.Compiler(b),d=a.toSource();eval(d);return d},find:function(b,a){var d=a.split('.'),f;while(f=d.shift()){b=b[f];if(b===undefined)throw new Error('Cannot find object named '+a);}return b},forEach:function(b,a,d){for(var f=0,e=b.length;f<e;f++)a.call(d,b[f],f)},formatError:function(b){var a=b.input.split(/\n/g),d=0,f=0;while(f<b.offset+1){f+=a[d].length+1;d+=1}var e='Line '+d+': expected '+b.expected+'\n',c=a[d-1];e+=c+'\n';f-=c.length+1;while(f<b.offset){e+=' ';f+=1}return e+'^'}});(function(){var l=function(b,a){if(!b||!a)return b;for(var d in a){if(b[d]!==a[d])b[d]=a[d]}return b};var S=function(b,a){var d=a.split('.'),f;while(f=d.shift()){b=b[f];if(b===undefined)throw new Error('Cannot find object named '+a);}return b};var bd=function(b){var a=b.input.split(/\n/g),d=0,f=0;while(f<b.offset+1){f+=a[d].length+1;d+=1}var e='Line '+d+': expected '+b.expected+'\n',c=a[d-1];e+=c+'\n';f-=c.length+1;while(f<b.offset){e+=' ';f+=1}return e+'^'};var bc={__consume__grammar:function(b){var a=null,d=this._offset;this._nodeCache["grammar"]=this._nodeCache["grammar"]||{};var f=this._nodeCache["grammar"][d];if(f){this._offset+=f.textValue.length;return f}var e=this._offset,c=[],k={},h="";var g=null;var i=0,q=this._offset,r=[],m="",j=true;while(j){j=this.__consume__space();if(j){r.push(j);m+=j.textValue;i-=1}}if(i<=0){this._offset=q;var o=this.constructor.SyntaxNode;var t=null;g=new o(m,this._offset,r);if(typeof t==="object"){l(g,t)}this._offset+=m.length}else{g=null}if(g){c.push(g);h+=g.textValue;var p=null;p=this.__consume__grammar_name();if(p){c.push(p);h+=p.textValue;k.grammar_name=p;var v=null;var n=1,w=this._offset,y=[],u="",A=true;while(A){var B=this._offset,s=[],E={},x="";var z=null;var F=0,C=this._offset,D=[],I="",G=true;while(G){G=this.__consume__space();if(G){D.push(G);I+=G.textValue;F-=1}}if(F<=0){this._offset=C;var L=this.constructor.SyntaxNode;var Q=null;z=new L(I,this._offset,D);if(typeof Q==="object"){l(z,Q)}this._offset+=I.length}else{z=null}if(z){s.push(z);x+=z.textValue;var M=null;M=this.__consume__grammar_rule();if(M){s.push(M);x+=M.textValue;E.grammar_rule=M}else{s=null;this._offset=B}}else{s=null;this._offset=B}if(s){this._offset=B;var N=this.constructor.SyntaxNode;var H=null;A=new N(x,this._offset,s,E);if(typeof H==="object"){l(A,H)}this._offset+=x.length}else{A=null}if(A){y.push(A);u+=A.textValue;n-=1}}if(n<=0){this._offset=w;var V=this.constructor.SyntaxNode;var R=null;v=new V(u,this._offset,y);if(typeof R==="object"){l(v,R)}this._offset+=u.length}else{v=null}if(v){c.push(v);h+=v.textValue;k.rules=v;var J=null;var X=0,T=this._offset,K=[],O="",P=true;while(P){P=this.__consume__space();if(P){K.push(P);O+=P.textValue;X-=1}}if(X<=0){this._offset=T;var U=this.constructor.SyntaxNode;var W=null;J=new U(O,this._offset,K);if(typeof W==="object"){l(J,W)}this._offset+=O.length}else{J=null}if(J){c.push(J);h+=J.textValue}else{c=null;this._offset=e}}else{c=null;this._offset=e}}else{c=null;this._offset=e}}else{c=null;this._offset=e}if(c){this._offset=e;var ba=this.constructor.SyntaxNode;var Y=S(this.constructor,"Grammar");a=new ba(h,this._offset,c,k);if(typeof Y==="object"){l(a,Y)}this._offset+=h.length}else{a=null}return this._nodeCache["grammar"][d]=a},__consume__grammar_name:function(b){var a=null,d=this._offset;this._nodeCache["grammar_name"]=this._nodeCache["grammar_name"]||{};var f=this._nodeCache["grammar_name"][d];if(f){this._offset+=f.textValue.length;return f}var e=this._offset,c=[],k={},h="";var g=null;var i=null;if(this._input.length>this._offset){i=this._input.substring(this._offset,this._offset+8)}else{i=null}if(i==="grammar "){var q=this.constructor.SyntaxNode;var r=null;g=new q("grammar ",this._offset,[]);if(typeof r==="object"){l(g,r)}this._offset+=8}else{g=null;var m=null;if(this._input.length>this._offset){m=this._input.substring(this._offset,this._offset+1)}else{m=null}if(!this.error||this.error.offset<=this._offset){this.error=this.constructor.lastError={input:this._input,offset:this._offset,expected:"\"grammar \""}}}if(g){c.push(g);h+=g.textValue;var j=null;j=this.__consume__object_identifier();if(j){c.push(j);h+=j.textValue;k.object_identifier=j}else{c=null;this._offset=e}}else{c=null;this._offset=e}if(c){this._offset=e;var o=this.constructor.SyntaxNode;var t=null;a=new o(h,this._offset,c,k);if(typeof t==="object"){l(a,t)}this._offset+=h.length}else{a=null}return this._nodeCache["grammar_name"][d]=a},__consume__grammar_rule:function(b){var a=null,d=this._offset;this._nodeCache["grammar_rule"]=this._nodeCache["grammar_rule"]||{};var f=this._nodeCache["grammar_rule"][d];if(f){this._offset+=f.textValue.length;return f}var e=this._offset,c=[],k={},h="";var g=null;g=this.__consume__identifier();if(g){c.push(g);h+=g.textValue;k.identifier=g;var i=null;i=this.__consume__assignment();if(i){c.push(i);h+=i.textValue;k.assignment=i;var q=null;q=this.__consume__parsing_expression();if(q){c.push(q);h+=q.textValue;k.parsing_expression=q}else{c=null;this._offset=e}}else{c=null;this._offset=e}}else{c=null;this._offset=e}if(c){this._offset=e;var r=this.constructor.SyntaxNode;var m=S(this.constructor,"GrammarRule");a=new r(h,this._offset,c,k);if(typeof m==="object"){l(a,m)}this._offset+=h.length}else{a=null}return this._nodeCache["grammar_rule"][d]=a},__consume__assignment:function(b){var a=null,d=this._offset;this._nodeCache["assignment"]=this._nodeCache["assignment"]||{};var f=this._nodeCache["assignment"][d];if(f){this._offset+=f.textValue.length;return f}var e=this._offset,c=[],k={},h="";var g=null;var i=1,q=this._offset,r=[],m="",j=true;while(j){j=this.__consume__space();if(j){r.push(j);m+=j.textValue;i-=1}}if(i<=0){this._offset=q;var o=this.constructor.SyntaxNode;var t=null;g=new o(m,this._offset,r);if(typeof t==="object"){l(g,t)}this._offset+=m.length}else{g=null}if(g){c.push(g);h+=g.textValue;var p=null;var v=null;if(this._input.length>this._offset){v=this._input.substring(this._offset,this._offset+2)}else{v=null}if(v==="<-"){var n=this.constructor.SyntaxNode;var w=null;p=new n("<-",this._offset,[]);if(typeof w==="object"){l(p,w)}this._offset+=2}else{p=null;var y=null;if(this._input.length>this._offset){y=this._input.substring(this._offset,this._offset+1)}else{y=null}if(!this.error||this.error.offset<=this._offset){this.error=this.constructor.lastError={input:this._input,offset:this._offset,expected:"\"<-\""}}}if(p){c.push(p);h+=p.textValue;var u=null;var A=1,B=this._offset,s=[],E="",x=true;while(x){x=this.__consume__space();if(x){s.push(x);E+=x.textValue;A-=1}}if(A<=0){this._offset=B;var z=this.constructor.SyntaxNode;var F=null;u=new z(E,this._offset,s);if(typeof F==="object"){l(u,F)}this._offset+=E.length}else{u=null}if(u){c.push(u);h+=u.textValue}else{c=null;this._offset=e}}else{c=null;this._offset=e}}else{c=null;this._offset=e}if(c){this._offset=e;var C=this.constructor.SyntaxNode;var D=null;a=new C(h,this._offset,c,k);if(typeof D==="object"){l(a,D)}this._offset+=h.length}else{a=null}return this._nodeCache["assignment"][d]=a},__consume__parsing_expression:function(b){var a=null,d=this._offset;this._nodeCache["parsing_expression"]=this._nodeCache["parsing_expression"]||{};var f=this._nodeCache["parsing_expression"][d];if(f){this._offset+=f.textValue.length;return f}var e=this._offset;a=this.__consume__choice_expression();if(a){}else{this._offset=e;a=this.__consume__choice_part();if(a){}else{this._offset=e}}return this._nodeCache["parsing_expression"][d]=a},__consume__parenthesised_expression:function(b){var a=null,d=this._offset;this._nodeCache["parenthesised_expression"]=this._nodeCache["parenthesised_expression"]||{};var f=this._nodeCache["parenthesised_expression"][d];if(f){this._offset+=f.textValue.length;return f}var e=this._offset,c=[],k={},h="";var g=null;var i=null;if(this._input.length>this._offset){i=this._input.substring(this._offset,this._offset+1)}else{i=null}if(i==="("){var q=this.constructor.SyntaxNode;var r=null;g=new q("(",this._offset,[]);if(typeof r==="object"){l(g,r)}this._offset+=1}else{g=null;var m=null;if(this._input.length>this._offset){m=this._input.substring(this._offset,this._offset+1)}else{m=null}if(!this.error||this.error.offset<=this._offset){this.error=this.constructor.lastError={input:this._input,offset:this._offset,expected:"\"(\""}}}if(g){c.push(g);h+=g.textValue;var j=null;var o=0,t=this._offset,p=[],v="",n=true;while(n){n=this.__consume__space();if(n){p.push(n);v+=n.textValue;o-=1}}if(o<=0){this._offset=t;var w=this.constructor.SyntaxNode;var y=null;j=new w(v,this._offset,p);if(typeof y==="object"){l(j,y)}this._offset+=v.length}else{j=null}if(j){c.push(j);h+=j.textValue;var u=null;u=this.__consume__parsing_expression();if(u){c.push(u);h+=u.textValue;k.parsing_expression=u;var A=null;var B=0,s=this._offset,E=[],x="",z=true;while(z){z=this.__consume__space();if(z){E.push(z);x+=z.textValue;B-=1}}if(B<=0){this._offset=s;var F=this.constructor.SyntaxNode;var C=null;A=new F(x,this._offset,E);if(typeof C==="object"){l(A,C)}this._offset+=x.length}else{A=null}if(A){c.push(A);h+=A.textValue;var D=null;var I=null;if(this._input.length>this._offset){I=this._input.substring(this._offset,this._offset+1)}else{I=null}if(I===")"){var G=this.constructor.SyntaxNode;var L=null;D=new G(")",this._offset,[]);if(typeof L==="object"){l(D,L)}this._offset+=1}else{D=null;var Q=null;if(this._input.length>this._offset){Q=this._input.substring(this._offset,this._offset+1)}else{Q=null}if(!this.error||this.error.offset<=this._offset){this.error=this.constructor.lastError={input:this._input,offset:this._offset,expected:"\")\""}}}if(D){c.push(D);h+=D.textValue}else{c=null;this._offset=e}}else{c=null;this._offset=e}}else{c=null;this._offset=e}}else{c=null;this._offset=e}}else{c=null;this._offset=e}if(c){this._offset=e;var M=this.constructor.SyntaxNode;var N=null;a=new M(h,this._offset,c,k);if(typeof N==="object"){l(a,N)}this._offset+=h.length}else{a=null}return this._nodeCache["parenthesised_expression"][d]=a},__consume__choice_expression:function(b){var a=null,d=this._offset;this._nodeCache["choice_expression"]=this._nodeCache["choice_expression"]||{};var f=this._nodeCache["choice_expression"][d];if(f){this._offset+=f.textValue.length;return f}var e=this._offset,c=[],k={},h="";var g=null;g=this.__consume__choice_part();if(g){c.push(g);h+=g.textValue;k.first_part=g;var i=null;var q=1,r=this._offset,m=[],j="",o=true;while(o){var t=this._offset,p=[],v={},n="";var w=null;var y=1,u=this._offset,A=[],B="",s=true;while(s){s=this.__consume__space();if(s){A.push(s);B+=s.textValue;y-=1}}if(y<=0){this._offset=u;var E=this.constructor.SyntaxNode;var x=null;w=new E(B,this._offset,A);if(typeof x==="object"){l(w,x)}this._offset+=B.length}else{w=null}if(w){p.push(w);n+=w.textValue;var z=null;var F=null;if(this._input.length>this._offset){F=this._input.substring(this._offset,this._offset+1)}else{F=null}if(F==="/"){var C=this.constructor.SyntaxNode;var D=null;z=new C("/",this._offset,[]);if(typeof D==="object"){l(z,D)}this._offset+=1}else{z=null;var I=null;if(this._input.length>this._offset){I=this._input.substring(this._offset,this._offset+1)}else{I=null}if(!this.error||this.error.offset<=this._offset){this.error=this.constructor.lastError={input:this._input,offset:this._offset,expected:"\"/\""}}}if(z){p.push(z);n+=z.textValue;var G=null;var L=1,Q=this._offset,M=[],N="",H=true;while(H){H=this.__consume__space();if(H){M.push(H);N+=H.textValue;L-=1}}if(L<=0){this._offset=Q;var V=this.constructor.SyntaxNode;var R=null;G=new V(N,this._offset,M);if(typeof R==="object"){l(G,R)}this._offset+=N.length}else{G=null}if(G){p.push(G);n+=G.textValue;var J=null;J=this.__consume__choice_part();if(J){p.push(J);n+=J.textValue;v.expression=J}else{p=null;this._offset=t}}else{p=null;this._offset=t}}else{p=null;this._offset=t}}else{p=null;this._offset=t}if(p){this._offset=t;var X=this.constructor.SyntaxNode;var T=null;o=new X(n,this._offset,p,v);if(typeof T==="object"){l(o,T)}this._offset+=n.length}else{o=null}if(o){m.push(o);j+=o.textValue;q-=1}}if(q<=0){this._offset=r;var K=this.constructor.SyntaxNode;var O=null;i=new K(j,this._offset,m);if(typeof O==="object"){l(i,O)}this._offset+=j.length}else{i=null}if(i){c.push(i);h+=i.textValue;k.rest=i}else{c=null;this._offset=e}}else{c=null;this._offset=e}if(c){this._offset=e;var P=this.constructor.SyntaxNode;var U=S(this.constructor,"Choice");a=new P(h,this._offset,c,k);if(typeof U==="object"){l(a,U)}this._offset+=h.length}else{a=null}return this._nodeCache["choice_expression"][d]=a},__consume__choice_part:function(b){var a=null,d=this._offset;this._nodeCache["choice_part"]=this._nodeCache["choice_part"]||{};var f=this._nodeCache["choice_part"][d];if(f){this._offset+=f.textValue.length;return f}var e=this._offset,c=[],k={},h="";var g=null;var i=this._offset;g=this.__consume__sequence_expression();if(g){}else{this._offset=i;g=this.__consume__sequence_part();if(g){}else{this._offset=i}}if(g){c.push(g);h+=g.textValue;var q=null;var r=this._offset;var m=this._offset,j=[],o={},t="";var p=null;var v=1,n=this._offset,w=[],y="",u=true;while(u){u=this.__consume__space();if(u){w.push(u);y+=u.textValue;v-=1}}if(v<=0){this._offset=n;var A=this.constructor.SyntaxNode;var B=null;p=new A(y,this._offset,w);if(typeof B==="object"){l(p,B)}this._offset+=y.length}else{p=null}if(p){j.push(p);t+=p.textValue;var s=null;s=this.__consume__type_expression();if(s){j.push(s);t+=s.textValue;o.type_expression=s}else{j=null;this._offset=m}}else{j=null;this._offset=m}if(j){this._offset=m;var E=this.constructor.SyntaxNode;var x=null;q=new E(t,this._offset,j,o);if(typeof x==="object"){l(q,x)}this._offset+=t.length}else{q=null}if(q){}else{this._offset=r;var z=this.constructor.SyntaxNode;var F=null;q=new z("",this._offset,[]);if(typeof F==="object"){l(q,F)}this._offset+=0}if(q){c.push(q);h+=q.textValue}else{c=null;this._offset=e}}else{c=null;this._offset=e}if(c){this._offset=e;var C=this.constructor.SyntaxNode;var D=S(this.constructor,"ChoicePart");a=new C(h,this._offset,c,k);if(typeof D==="object"){l(a,D)}this._offset+=h.length}else{a=null}return this._nodeCache["choice_part"][d]=a},__consume__type_expression:function(b){var a=null,d=this._offset;this._nodeCache["type_expression"]=this._nodeCache["type_expression"]||{};var f=this._nodeCache["type_expression"][d];if(f){this._offset+=f.textValue.length;return f}var e=this._offset,c=[],k={},h="";var g=null;var i=null;if(this._input.length>this._offset){i=this._input.substring(this._offset,this._offset+1)}else{i=null}if(i==="<"){var q=this.constructor.SyntaxNode;var r=null;g=new q("<",this._offset,[]);if(typeof r==="object"){l(g,r)}this._offset+=1}else{g=null;var m=null;if(this._input.length>this._offset){m=this._input.substring(this._offset,this._offset+1)}else{m=null}if(!this.error||this.error.offset<=this._offset){this.error=this.constructor.lastError={input:this._input,offset:this._offset,expected:"\"<\""}}}if(g){c.push(g);h+=g.textValue;var j=null;j=this.__consume__object_identifier();if(j){c.push(j);h+=j.textValue;k.object_identifier=j;var o=null;var t=null;if(this._input.length>this._offset){t=this._input.substring(this._offset,this._offset+1)}else{t=null}if(t===">"){var p=this.constructor.SyntaxNode;var v=null;o=new p(">",this._offset,[]);if(typeof v==="object"){l(o,v)}this._offset+=1}else{o=null;var n=null;if(this._input.length>this._offset){n=this._input.substring(this._offset,this._offset+1)}else{n=null}if(!this.error||this.error.offset<=this._offset){this.error=this.constructor.lastError={input:this._input,offset:this._offset,expected:"\">\""}}}if(o){c.push(o);h+=o.textValue}else{c=null;this._offset=e}}else{c=null;this._offset=e}}else{c=null;this._offset=e}if(c){this._offset=e;var w=this.constructor.SyntaxNode;var y=null;a=new w(h,this._offset,c,k);if(typeof y==="object"){l(a,y)}this._offset+=h.length}else{a=null}return this._nodeCache["type_expression"][d]=a},__consume__sequence_expression:function(b){var a=null,d=this._offset;this._nodeCache["sequence_expression"]=this._nodeCache["sequence_expression"]||{};var f=this._nodeCache["sequence_expression"][d];if(f){this._offset+=f.textValue.length;return f}var e=this._offset,c=[],k={},h="";var g=null;g=this.__consume__sequence_part();if(g){c.push(g);h+=g.textValue;k.first_part=g;var i=null;var q=1,r=this._offset,m=[],j="",o=true;while(o){var t=this._offset,p=[],v={},n="";var w=null;var y=1,u=this._offset,A=[],B="",s=true;while(s){s=this.__consume__space();if(s){A.push(s);B+=s.textValue;y-=1}}if(y<=0){this._offset=u;var E=this.constructor.SyntaxNode;var x=null;w=new E(B,this._offset,A);if(typeof x==="object"){l(w,x)}this._offset+=B.length}else{w=null}if(w){p.push(w);n+=w.textValue;var z=null;z=this.__consume__sequence_part();if(z){p.push(z);n+=z.textValue;v.expression=z}else{p=null;this._offset=t}}else{p=null;this._offset=t}if(p){this._offset=t;var F=this.constructor.SyntaxNode;var C=null;o=new F(n,this._offset,p,v);if(typeof C==="object"){l(o,C)}this._offset+=n.length}else{o=null}if(o){m.push(o);j+=o.textValue;q-=1}}if(q<=0){this._offset=r;var D=this.constructor.SyntaxNode;var I=null;i=new D(j,this._offset,m);if(typeof I==="object"){l(i,I)}this._offset+=j.length}else{i=null}if(i){c.push(i);h+=i.textValue;k.rest=i}else{c=null;this._offset=e}}else{c=null;this._offset=e}if(c){this._offset=e;var G=this.constructor.SyntaxNode;var L=S(this.constructor,"Sequence");a=new G(h,this._offset,c,k);if(typeof L==="object"){l(a,L)}this._offset+=h.length}else{a=null}return this._nodeCache["sequence_expression"][d]=a},__consume__sequence_part:function(b){var a=null,d=this._offset;this._nodeCache["sequence_part"]=this._nodeCache["sequence_part"]||{};var f=this._nodeCache["sequence_part"][d];if(f){this._offset+=f.textValue.length;return f}var e=this._offset,c=[],k={},h="";var g=null;var i=this._offset;g=this.__consume__label();if(g){}else{this._offset=i;var q=this.constructor.SyntaxNode;var r=null;g=new q("",this._offset,[]);if(typeof r==="object"){l(g,r)}this._offset+=0}if(g){c.push(g);h+=g.textValue;var m=null;var j=this._offset;m=this.__consume__quantified_atom();if(m){}else{this._offset=j;m=this.__consume__atom();if(m){}else{this._offset=j}}if(m){c.push(m);h+=m.textValue;k.expression=m}else{c=null;this._offset=e}}else{c=null;this._offset=e}if(c){this._offset=e;var o=this.constructor.SyntaxNode;var t=S(this.constructor,"SequencePart");a=new o(h,this._offset,c,k);if(typeof t==="object"){l(a,t)}this._offset+=h.length}else{a=null}return this._nodeCache["sequence_part"][d]=a},__consume__quantified_atom:function(b){var a=null,d=this._offset;this._nodeCache["quantified_atom"]=this._nodeCache["quantified_atom"]||{};var f=this._nodeCache["quantified_atom"][d];if(f){this._offset+=f.textValue.length;return f}var e=this._offset,c=[],k={},h="";var g=null;g=this.__consume__atom();if(g){c.push(g);h+=g.textValue;k.atom=g;var i=null;i=this.__consume__quantifier();if(i){c.push(i);h+=i.textValue;k.quantifier=i}else{c=null;this._offset=e}}else{c=null;this._offset=e}if(c){this._offset=e;var q=this.constructor.SyntaxNode;var r=S(this.constructor,"Repeat");a=new q(h,this._offset,c,k);if(typeof r==="object"){l(a,r)}this._offset+=h.length}else{a=null}return this._nodeCache["quantified_atom"][d]=a},__consume__atom:function(b){var a=null,d=this._offset;this._nodeCache["atom"]=this._nodeCache["atom"]||{};var f=this._nodeCache["atom"][d];if(f){this._offset+=f.textValue.length;return f}var e=this._offset;a=this.__consume__parenthesised_expression();if(a){}else{this._offset=e;a=this.__consume__predicated_atom();if(a){}else{this._offset=e;a=this.__consume__reference_expression();if(a){}else{this._offset=e;a=this.__consume__string_expression();if(a){}else{this._offset=e;a=this.__consume__ci_string_expression();if(a){}else{this._offset=e;a=this.__consume__any_char_expression();if(a){}else{this._offset=e;a=this.__consume__char_class_expression();if(a){}else{this._offset=e}}}}}}}return this._nodeCache["atom"][d]=a},__consume__predicated_atom:function(b){var a=null,d=this._offset;this._nodeCache["predicated_atom"]=this._nodeCache["predicated_atom"]||{};var f=this._nodeCache["predicated_atom"][d];if(f){this._offset+=f.textValue.length;return f}var e=this._offset,c=[],k={},h="";var g=null;var i=this._offset;var q=null;if(this._input.length>this._offset){q=this._input.substring(this._offset,this._offset+1)}else{q=null}if(q==="&"){var r=this.constructor.SyntaxNode;var m=null;g=new r("&",this._offset,[]);if(typeof m==="object"){l(g,m)}this._offset+=1}else{g=null;var j=null;if(this._input.length>this._offset){j=this._input.substring(this._offset,this._offset+1)}else{j=null}if(!this.error||this.error.offset<=this._offset){this.error=this.constructor.lastError={input:this._input,offset:this._offset,expected:"\"&\""}}}if(g){}else{this._offset=i;var o=null;if(this._input.length>this._offset){o=this._input.substring(this._offset,this._offset+1)}else{o=null}if(o==="!"){var t=this.constructor.SyntaxNode;var p=null;g=new t("!",this._offset,[]);if(typeof p==="object"){l(g,p)}this._offset+=1}else{g=null;var v=null;if(this._input.length>this._offset){v=this._input.substring(this._offset,this._offset+1)}else{v=null}if(!this.error||this.error.offset<=this._offset){this.error=this.constructor.lastError={input:this._input,offset:this._offset,expected:"\"!\""}}}if(g){}else{this._offset=i}}if(g){c.push(g);h+=g.textValue;k.predicate=g;var n=null;n=this.__consume__atom();if(n){c.push(n);h+=n.textValue;k.atom=n}else{c=null;this._offset=e}}else{c=null;this._offset=e}if(c){this._offset=e;var w=this.constructor.SyntaxNode;var y=S(this.constructor,"Predicate");a=new w(h,this._offset,c,k);if(typeof y==="object"){l(a,y)}this._offset+=h.length}else{a=null}return this._nodeCache["predicated_atom"][d]=a},__consume__reference_expression:function(b){var a=null,d=this._offset;this._nodeCache["reference_expression"]=this._nodeCache["reference_expression"]||{};var f=this._nodeCache["reference_expression"][d];if(f){this._offset+=f.textValue.length;return f}var e=this._offset,c=[],k={},h="";var g=null;g=this.__consume__identifier();if(g){c.push(g);h+=g.textValue;k.identifier=g;var i=null;var q=this._offset;i=this.__consume__assignment();this._offset=q;if(!(i)){var r=this.constructor.SyntaxNode;var m=null;i=new r("",this._offset,[]);if(typeof m==="object"){l(i,m)}this._offset+=0}else{i=null}if(i){c.push(i);h+=i.textValue}else{c=null;this._offset=e}}else{c=null;this._offset=e}if(c){this._offset=e;var j=this.constructor.SyntaxNode;var o=S(this.constructor,"Reference");a=new j(h,this._offset,c,k);if(typeof o==="object"){l(a,o)}this._offset+=h.length}else{a=null}return this._nodeCache["reference_expression"][d]=a},__consume__string_expression:function(b){var a=null,d=this._offset;this._nodeCache["string_expression"]=this._nodeCache["string_expression"]||{};var f=this._nodeCache["string_expression"][d];if(f){this._offset+=f.textValue.length;return f}var e=this._offset,c=[],k={},h="";var g=null;var i=null;if(this._input.length>this._offset){i=this._input.substring(this._offset,this._offset+1)}else{i=null}if(i==="\""){var q=this.constructor.SyntaxNode;var r=null;g=new q("\"",this._offset,[]);if(typeof r==="object"){l(g,r)}this._offset+=1}else{g=null;var m=null;if(this._input.length>this._offset){m=this._input.substring(this._offset,this._offset+1)}else{m=null}if(!this.error||this.error.offset<=this._offset){this.error=this.constructor.lastError={input:this._input,offset:this._offset,expected:"\"\\\"\""}}}if(g){c.push(g);h+=g.textValue;var j=null;var o=0,t=this._offset,p=[],v="",n=true;while(n){var w=this._offset;var y=this._offset,u=[],A={},B="";var s=null;var E=null;if(this._input.length>this._offset){E=this._input.substring(this._offset,this._offset+1)}else{E=null}if(E==="\\"){var x=this.constructor.SyntaxNode;var z=null;s=new x("\\",this._offset,[]);if(typeof z==="object"){l(s,z)}this._offset+=1}else{s=null;var F=null;if(this._input.length>this._offset){F=this._input.substring(this._offset,this._offset+1)}else{F=null}if(!this.error||this.error.offset<=this._offset){this.error=this.constructor.lastError={input:this._input,offset:this._offset,expected:"\"\\\\\""}}}if(s){u.push(s);B+=s.textValue;var C=null;var D=null;if(this._input.length>this._offset){D=this._input.substring(this._offset,this._offset+1)}else{D=null}var I=D;if(I===null){C=null;var G=null;if(this._input.length>this._offset){G=this._input.substring(this._offset,this._offset+1)}else{G=null}if(!this.error||this.error.offset<=this._offset){this.error=this.constructor.lastError={input:this._input,offset:this._offset,expected:"<any char>"}}}else{var L=this.constructor.SyntaxNode;var Q=null;C=new L(I,this._offset,[]);if(typeof Q==="object"){l(C,Q)}this._offset+=1}if(C){u.push(C);B+=C.textValue}else{u=null;this._offset=y}}else{u=null;this._offset=y}if(u){this._offset=y;var M=this.constructor.SyntaxNode;var N=null;n=new M(B,this._offset,u,A);if(typeof N==="object"){l(n,N)}this._offset+=B.length}else{n=null}if(n){}else{this._offset=w;var H=null;if(this._input.length>this._offset){H=this._input.substring(this._offset,this._offset+1)}else{H=null}if(H&&/^[^"]/.test(H)){var V=this.constructor.SyntaxNode;var R=null;n=new V(H,this._offset,[]);if(typeof R==="object"){l(n,R)}this._offset+=1}else{n=null;var J=null;if(this._input.length>this._offset){J=this._input.substring(this._offset,this._offset+1)}else{J=null}if(!this.error||this.error.offset<=this._offset){this.error=this.constructor.lastError={input:this._input,offset:this._offset,expected:"[^\"]"}}}if(n){}else{this._offset=w}}if(n){p.push(n);v+=n.textValue;o-=1}}if(o<=0){this._offset=t;var X=this.constructor.SyntaxNode;var T=null;j=new X(v,this._offset,p);if(typeof T==="object"){l(j,T)}this._offset+=v.length}else{j=null}if(j){c.push(j);h+=j.textValue;var K=null;var O=null;if(this._input.length>this._offset){O=this._input.substring(this._offset,this._offset+1)}else{O=null}if(O==="\""){var P=this.constructor.SyntaxNode;var U=null;K=new P("\"",this._offset,[]);if(typeof U==="object"){l(K,U)}this._offset+=1}else{K=null;var W=null;if(this._input.length>this._offset){W=this._input.substring(this._offset,this._offset+1)}else{W=null}if(!this.error||this.error.offset<=this._offset){this.error=this.constructor.lastError={input:this._input,offset:this._offset,expected:"\"\\\"\""}}}if(K){c.push(K);h+=K.textValue}else{c=null;this._offset=e}}else{c=null;this._offset=e}}else{c=null;this._offset=e}if(c){this._offset=e;var ba=this.constructor.SyntaxNode;var Y=S(this.constructor,"String");a=new ba(h,this._offset,c,k);if(typeof Y==="object"){l(a,Y)}this._offset+=h.length}else{a=null}return this._nodeCache["string_expression"][d]=a},__consume__ci_string_expression:function(b){var a=null,d=this._offset;this._nodeCache["ci_string_expression"]=this._nodeCache["ci_string_expression"]||{};var f=this._nodeCache["ci_string_expression"][d];if(f){this._offset+=f.textValue.length;return f}var e=this._offset,c=[],k={},h="";var g=null;var i=null;if(this._input.length>this._offset){i=this._input.substring(this._offset,this._offset+1)}else{i=null}if(i==="`"){var q=this.constructor.SyntaxNode;var r=null;g=new q("`",this._offset,[]);if(typeof r==="object"){l(g,r)}this._offset+=1}else{g=null;var m=null;if(this._input.length>this._offset){m=this._input.substring(this._offset,this._offset+1)}else{m=null}if(!this.error||this.error.offset<=this._offset){this.error=this.constructor.lastError={input:this._input,offset:this._offset,expected:"\"`\""}}}if(g){c.push(g);h+=g.textValue;var j=null;var o=0,t=this._offset,p=[],v="",n=true;while(n){var w=this._offset;var y=this._offset,u=[],A={},B="";var s=null;var E=null;if(this._input.length>this._offset){E=this._input.substring(this._offset,this._offset+1)}else{E=null}if(E==="\\"){var x=this.constructor.SyntaxNode;var z=null;s=new x("\\",this._offset,[]);if(typeof z==="object"){l(s,z)}this._offset+=1}else{s=null;var F=null;if(this._input.length>this._offset){F=this._input.substring(this._offset,this._offset+1)}else{F=null}if(!this.error||this.error.offset<=this._offset){this.error=this.constructor.lastError={input:this._input,offset:this._offset,expected:"\"\\\\\""}}}if(s){u.push(s);B+=s.textValue;var C=null;var D=null;if(this._input.length>this._offset){D=this._input.substring(this._offset,this._offset+1)}else{D=null}var I=D;if(I===null){C=null;var G=null;if(this._input.length>this._offset){G=this._input.substring(this._offset,this._offset+1)}else{G=null}if(!this.error||this.error.offset<=this._offset){this.error=this.constructor.lastError={input:this._input,offset:this._offset,expected:"<any char>"}}}else{var L=this.constructor.SyntaxNode;var Q=null;C=new L(I,this._offset,[]);if(typeof Q==="object"){l(C,Q)}this._offset+=1}if(C){u.push(C);B+=C.textValue}else{u=null;this._offset=y}}else{u=null;this._offset=y}if(u){this._offset=y;var M=this.constructor.SyntaxNode;var N=null;n=new M(B,this._offset,u,A);if(typeof N==="object"){l(n,N)}this._offset+=B.length}else{n=null}if(n){}else{this._offset=w;var H=null;if(this._input.length>this._offset){H=this._input.substring(this._offset,this._offset+1)}else{H=null}if(H&&/^[^`]/.test(H)){var V=this.constructor.SyntaxNode;var R=null;n=new V(H,this._offset,[]);if(typeof R==="object"){l(n,R)}this._offset+=1}else{n=null;var J=null;if(this._input.length>this._offset){J=this._input.substring(this._offset,this._offset+1)}else{J=null}if(!this.error||this.error.offset<=this._offset){this.error=this.constructor.lastError={input:this._input,offset:this._offset,expected:"[^`]"}}}if(n){}else{this._offset=w}}if(n){p.push(n);v+=n.textValue;o-=1}}if(o<=0){this._offset=t;var X=this.constructor.SyntaxNode;var T=null;j=new X(v,this._offset,p);if(typeof T==="object"){l(j,T)}this._offset+=v.length}else{j=null}if(j){c.push(j);h+=j.textValue;var K=null;var O=null;if(this._input.length>this._offset){O=this._input.substring(this._offset,this._offset+1)}else{O=null}if(O==="`"){var P=this.constructor.SyntaxNode;var U=null;K=new P("`",this._offset,[]);if(typeof U==="object"){l(K,U)}this._offset+=1}else{K=null;var W=null;if(this._input.length>this._offset){W=this._input.substring(this._offset,this._offset+1)}else{W=null}if(!this.error||this.error.offset<=this._offset){this.error=this.constructor.lastError={input:this._input,offset:this._offset,expected:"\"`\""}}}if(K){c.push(K);h+=K.textValue}else{c=null;this._offset=e}}else{c=null;this._offset=e}}else{c=null;this._offset=e}if(c){this._offset=e;var ba=this.constructor.SyntaxNode;var Y=S(this.constructor,"CIString");a=new ba(h,this._offset,c,k);if(typeof Y==="object"){l(a,Y)}this._offset+=h.length}else{a=null}return this._nodeCache["ci_string_expression"][d]=a},__consume__any_char_expression:function(b){var a=null,d=this._offset;this._nodeCache["any_char_expression"]=this._nodeCache["any_char_expression"]||{};var f=this._nodeCache["any_char_expression"][d];if(f){this._offset+=f.textValue.length;return f}var e=null;if(this._input.length>this._offset){e=this._input.substring(this._offset,this._offset+1)}else{e=null}if(e==="."){var c=this.constructor.SyntaxNode;var k=S(this.constructor,"AnyChar");a=new c(".",this._offset,[]);if(typeof k==="object"){l(a,k)}this._offset+=1}else{a=null;var h=null;if(this._input.length>this._offset){h=this._input.substring(this._offset,this._offset+1)}else{h=null}if(!this.error||this.error.offset<=this._offset){this.error=this.constructor.lastError={input:this._input,offset:this._offset,expected:"\".\""}}}return this._nodeCache["any_char_expression"][d]=a},__consume__char_class_expression:function(b){var a=null,d=this._offset;this._nodeCache["char_class_expression"]=this._nodeCache["char_class_expression"]||{};var f=this._nodeCache["char_class_expression"][d];if(f){this._offset+=f.textValue.length;return f}var e=this._offset,c=[],k={},h="";var g=null;var i=null;if(this._input.length>this._offset){i=this._input.substring(this._offset,this._offset+1)}else{i=null}if(i==="["){var q=this.constructor.SyntaxNode;var r=null;g=new q("[",this._offset,[]);if(typeof r==="object"){l(g,r)}this._offset+=1}else{g=null;var m=null;if(this._input.length>this._offset){m=this._input.substring(this._offset,this._offset+1)}else{m=null}if(!this.error||this.error.offset<=this._offset){this.error=this.constructor.lastError={input:this._input,offset:this._offset,expected:"\"[\""}}}if(g){c.push(g);h+=g.textValue;var j=null;var o=this._offset;var t=null;if(this._input.length>this._offset){t=this._input.substring(this._offset,this._offset+1)}else{t=null}if(t==="^"){var p=this.constructor.SyntaxNode;var v=null;j=new p("^",this._offset,[]);if(typeof v==="object"){l(j,v)}this._offset+=1}else{j=null;var n=null;if(this._input.length>this._offset){n=this._input.substring(this._offset,this._offset+1)}else{n=null}if(!this.error||this.error.offset<=this._offset){this.error=this.constructor.lastError={input:this._input,offset:this._offset,expected:"\"^\""}}}if(j){}else{this._offset=o;var w=this.constructor.SyntaxNode;var y=null;j=new w("",this._offset,[]);if(typeof y==="object"){l(j,y)}this._offset+=0}if(j){c.push(j);h+=j.textValue;var u=null;var A=1,B=this._offset,s=[],E="",x=true;while(x){var z=this._offset;var F=this._offset,C=[],D={},I="";var G=null;var L=null;if(this._input.length>this._offset){L=this._input.substring(this._offset,this._offset+1)}else{L=null}if(L==="\\"){var Q=this.constructor.SyntaxNode;var M=null;G=new Q("\\",this._offset,[]);if(typeof M==="object"){l(G,M)}this._offset+=1}else{G=null;var N=null;if(this._input.length>this._offset){N=this._input.substring(this._offset,this._offset+1)}else{N=null}if(!this.error||this.error.offset<=this._offset){this.error=this.constructor.lastError={input:this._input,offset:this._offset,expected:"\"\\\\\""}}}if(G){C.push(G);I+=G.textValue;var H=null;var V=null;if(this._input.length>this._offset){V=this._input.substring(this._offset,this._offset+1)}else{V=null}var R=V;if(R===null){H=null;var J=null;if(this._input.length>this._offset){J=this._input.substring(this._offset,this._offset+1)}else{J=null}if(!this.error||this.error.offset<=this._offset){this.error=this.constructor.lastError={input:this._input,offset:this._offset,expected:"<any char>"}}}else{var X=this.constructor.SyntaxNode;var T=null;H=new X(R,this._offset,[]);if(typeof T==="object"){l(H,T)}this._offset+=1}if(H){C.push(H);I+=H.textValue}else{C=null;this._offset=F}}else{C=null;this._offset=F}if(C){this._offset=F;var K=this.constructor.SyntaxNode;var O=null;x=new K(I,this._offset,C,D);if(typeof O==="object"){l(x,O)}this._offset+=I.length}else{x=null}if(x){}else{this._offset=z;var P=null;if(this._input.length>this._offset){P=this._input.substring(this._offset,this._offset+1)}else{P=null}if(P&&/^[^\]]/.test(P)){var U=this.constructor.SyntaxNode;var W=null;x=new U(P,this._offset,[]);if(typeof W==="object"){l(x,W)}this._offset+=1}else{x=null;var ba=null;if(this._input.length>this._offset){ba=this._input.substring(this._offset,this._offset+1)}else{ba=null}if(!this.error||this.error.offset<=this._offset){this.error=this.constructor.lastError={input:this._input,offset:this._offset,expected:"[^\\]]"}}}if(x){}else{this._offset=z}}if(x){s.push(x);E+=x.textValue;A-=1}}if(A<=0){this._offset=B;var Y=this.constructor.SyntaxNode;var bg=null;u=new Y(E,this._offset,s);if(typeof bg==="object"){l(u,bg)}this._offset+=E.length}else{u=null}if(u){c.push(u);h+=u.textValue;var bb=null;var be=null;if(this._input.length>this._offset){be=this._input.substring(this._offset,this._offset+1)}else{be=null}if(be==="]"){var bl=this.constructor.SyntaxNode;var bh=null;bb=new bl("]",this._offset,[]);if(typeof bh==="object"){l(bb,bh)}this._offset+=1}else{bb=null;var bi=null;if(this._input.length>this._offset){bi=this._input.substring(this._offset,this._offset+1)}else{bi=null}if(!this.error||this.error.offset<=this._offset){this.error=this.constructor.lastError={input:this._input,offset:this._offset,expected:"\"]\""}}}if(bb){c.push(bb);h+=bb.textValue}else{c=null;this._offset=e}}else{c=null;this._offset=e}}else{c=null;this._offset=e}}else{c=null;this._offset=e}if(c){this._offset=e;var bm=this.constructor.SyntaxNode;var bj=S(this.constructor,"CharClass");a=new bm(h,this._offset,c,k);if(typeof bj==="object"){l(a,bj)}this._offset+=h.length}else{a=null}return this._nodeCache["char_class_expression"][d]=a},__consume__label:function(b){var a=null,d=this._offset;this._nodeCache["label"]=this._nodeCache["label"]||{};var f=this._nodeCache["label"][d];if(f){this._offset+=f.textValue.length;return f}var e=this._offset,c=[],k={},h="";var g=null;g=this.__consume__identifier();if(g){c.push(g);h+=g.textValue;k.identifier=g;var i=null;var q=null;if(this._input.length>this._offset){q=this._input.substring(this._offset,this._offset+1)}else{q=null}if(q===":"){var r=this.constructor.SyntaxNode;var m=null;i=new r(":",this._offset,[]);if(typeof m==="object"){l(i,m)}this._offset+=1}else{i=null;var j=null;if(this._input.length>this._offset){j=this._input.substring(this._offset,this._offset+1)}else{j=null}if(!this.error||this.error.offset<=this._offset){this.error=this.constructor.lastError={input:this._input,offset:this._offset,expected:"\":\""}}}if(i){c.push(i);h+=i.textValue}else{c=null;this._offset=e}}else{c=null;this._offset=e}if(c){this._offset=e;var o=this.constructor.SyntaxNode;var t=null;a=new o(h,this._offset,c,k);if(typeof t==="object"){l(a,t)}this._offset+=h.length}else{a=null}return this._nodeCache["label"][d]=a},__consume__object_identifier:function(b){var a=null,d=this._offset;this._nodeCache["object_identifier"]=this._nodeCache["object_identifier"]||{};var f=this._nodeCache["object_identifier"][d];if(f){this._offset+=f.textValue.length;return f}var e=this._offset,c=[],k={},h="";var g=null;g=this.__consume__identifier();if(g){c.push(g);h+=g.textValue;k.identifier=g;var i=null;var q=0,r=this._offset,m=[],j="",o=true;while(o){var t=this._offset,p=[],v={},n="";var w=null;var y=null;if(this._input.length>this._offset){y=this._input.substring(this._offset,this._offset+1)}else{y=null}if(y==="."){var u=this.constructor.SyntaxNode;var A=null;w=new u(".",this._offset,[]);if(typeof A==="object"){l(w,A)}this._offset+=1}else{w=null;var B=null;if(this._input.length>this._offset){B=this._input.substring(this._offset,this._offset+1)}else{B=null}if(!this.error||this.error.offset<=this._offset){this.error=this.constructor.lastError={input:this._input,offset:this._offset,expected:"\".\""}}}if(w){p.push(w);n+=w.textValue;var s=null;s=this.__consume__identifier();if(s){p.push(s);n+=s.textValue;v.identifier=s}else{p=null;this._offset=t}}else{p=null;this._offset=t}if(p){this._offset=t;var E=this.constructor.SyntaxNode;var x=null;o=new E(n,this._offset,p,v);if(typeof x==="object"){l(o,x)}this._offset+=n.length}else{o=null}if(o){m.push(o);j+=o.textValue;q-=1}}if(q<=0){this._offset=r;var z=this.constructor.SyntaxNode;var F=null;i=new z(j,this._offset,m);if(typeof F==="object"){l(i,F)}this._offset+=j.length}else{i=null}if(i){c.push(i);h+=i.textValue}else{c=null;this._offset=e}}else{c=null;this._offset=e}if(c){this._offset=e;var C=this.constructor.SyntaxNode;var D=null;a=new C(h,this._offset,c,k);if(typeof D==="object"){l(a,D)}this._offset+=h.length}else{a=null}return this._nodeCache["object_identifier"][d]=a},__consume__identifier:function(b){var a=null,d=this._offset;this._nodeCache["identifier"]=this._nodeCache["identifier"]||{};var f=this._nodeCache["identifier"][d];if(f){this._offset+=f.textValue.length;return f}var e=this._offset,c=[],k={},h="";var g=null;var i=null;if(this._input.length>this._offset){i=this._input.substring(this._offset,this._offset+1)}else{i=null}if(i&&/^[a-zA-Z_$]/.test(i)){var q=this.constructor.SyntaxNode;var r=null;g=new q(i,this._offset,[]);if(typeof r==="object"){l(g,r)}this._offset+=1}else{g=null;var m=null;if(this._input.length>this._offset){m=this._input.substring(this._offset,this._offset+1)}else{m=null}if(!this.error||this.error.offset<=this._offset){this.error=this.constructor.lastError={input:this._input,offset:this._offset,expected:"[a-zA-Z_$]"}}}if(g){c.push(g);h+=g.textValue;var j=null;var o=0,t=this._offset,p=[],v="",n=true;while(n){var w=null;if(this._input.length>this._offset){w=this._input.substring(this._offset,this._offset+1)}else{w=null}if(w&&/^[a-zA-Z0-9_$]/.test(w)){var y=this.constructor.SyntaxNode;var u=null;n=new y(w,this._offset,[]);if(typeof u==="object"){l(n,u)}this._offset+=1}else{n=null;var A=null;if(this._input.length>this._offset){A=this._input.substring(this._offset,this._offset+1)}else{A=null}if(!this.error||this.error.offset<=this._offset){this.error=this.constructor.lastError={input:this._input,offset:this._offset,expected:"[a-zA-Z0-9_$]"}}}if(n){p.push(n);v+=n.textValue;o-=1}}if(o<=0){this._offset=t;var B=this.constructor.SyntaxNode;var s=null;j=new B(v,this._offset,p);if(typeof s==="object"){l(j,s)}this._offset+=v.length}else{j=null}if(j){c.push(j);h+=j.textValue}else{c=null;this._offset=e}}else{c=null;this._offset=e}if(c){this._offset=e;var E=this.constructor.SyntaxNode;var x=null;a=new E(h,this._offset,c,k);if(typeof x==="object"){l(a,x)}this._offset+=h.length}else{a=null}return this._nodeCache["identifier"][d]=a},__consume__quantifier:function(b){var a=null,d=this._offset;this._nodeCache["quantifier"]=this._nodeCache["quantifier"]||{};var f=this._nodeCache["quantifier"][d];if(f){this._offset+=f.textValue.length;return f}var e=this._offset;var c=null;if(this._input.length>this._offset){c=this._input.substring(this._offset,this._offset+1)}else{c=null}if(c==="?"){var k=this.constructor.SyntaxNode;var h=null;a=new k("?",this._offset,[]);if(typeof h==="object"){l(a,h)}this._offset+=1}else{a=null;var g=null;if(this._input.length>this._offset){g=this._input.substring(this._offset,this._offset+1)}else{g=null}if(!this.error||this.error.offset<=this._offset){this.error=this.constructor.lastError={input:this._input,offset:this._offset,expected:"\"?\""}}}if(a){}else{this._offset=e;var i=null;if(this._input.length>this._offset){i=this._input.substring(this._offset,this._offset+1)}else{i=null}if(i==="*"){var q=this.constructor.SyntaxNode;var r=null;a=new q("*",this._offset,[]);if(typeof r==="object"){l(a,r)}this._offset+=1}else{a=null;var m=null;if(this._input.length>this._offset){m=this._input.substring(this._offset,this._offset+1)}else{m=null}if(!this.error||this.error.offset<=this._offset){this.error=this.constructor.lastError={input:this._input,offset:this._offset,expected:"\"*\""}}}if(a){}else{this._offset=e;var j=null;if(this._input.length>this._offset){j=this._input.substring(this._offset,this._offset+1)}else{j=null}if(j==="+"){var o=this.constructor.SyntaxNode;var t=null;a=new o("+",this._offset,[]);if(typeof t==="object"){l(a,t)}this._offset+=1}else{a=null;var p=null;if(this._input.length>this._offset){p=this._input.substring(this._offset,this._offset+1)}else{p=null}if(!this.error||this.error.offset<=this._offset){this.error=this.constructor.lastError={input:this._input,offset:this._offset,expected:"\"+\""}}}if(a){}else{this._offset=e}}}return this._nodeCache["quantifier"][d]=a},__consume__space:function(b){var a=null,d=this._offset;this._nodeCache["space"]=this._nodeCache["space"]||{};var f=this._nodeCache["space"][d];if(f){this._offset+=f.textValue.length;return f}var e=null;if(this._input.length>this._offset){e=this._input.substring(this._offset,this._offset+1)}else{e=null}if(e&&/^[\s\n\r\t]/.test(e)){var c=this.constructor.SyntaxNode;var k=null;a=new c(e,this._offset,[]);if(typeof k==="object"){l(a,k)}this._offset+=1}else{a=null;var h=null;if(this._input.length>this._offset){h=this._input.substring(this._offset,this._offset+1)}else{h=null}if(!this.error||this.error.offset<=this._offset){this.error=this.constructor.lastError={input:this._input,offset:this._offset,expected:"[\\s\\n\\r\\t]"}}}return this._nodeCache["space"][d]=a}};var Z=function(b){this._input=b;this._offset=0;this._nodeCache={}};Z.prototype.parse=function(){var b=this.__consume__grammar();if(b&&this._offset===this._input.length){return b}if(!(this.error)){this.error={input:this._input,offset:this._offset,expected:"<EOF>"}}var a=bd(this.error);var d=new Error(a);throw d;};Z.parse=function(b){var a=new Z(b);return a.parse()};l(Z.prototype,bc);var bk=function(b,a,d,f){this.textValue=b;this.offset=a;this.elements=d||[];if(!f)return;for(var e in f)this[e]=f[e]};bk.prototype.forEach=function(b,a){for(var d=0,f=this.elements.length;d<f;d++){b.call(a,this.elements[d],d)}};Z.SyntaxNode=bk;if(typeof require==="function"&&typeof exports==="object"){exports.Grammar=bc;exports.Parser=Z;exports.parse=Z.parse;if(typeof Canopy!=="undefined"){Canopy.MetaGrammar=bc;Canopy.MetaGrammarParser=Z;Canopy.MetaGrammarParser.formatError=bd}}else{var bf=this;bf=bf.Canopy=bf.Canopy||{};Canopy.MetaGrammar=bc;Canopy.MetaGrammarParser=Z;Canopy.MetaGrammarParser.formatError=bd}})();Canopy.Builder=function(b){if(b){this._parent=b;this._indentLevel=b._indentLevel}else{this._buffer='';this._indentLevel=0}this._methodSeparator='';this._varIndex={}};Canopy.extend(Canopy.Builder.prototype,{serialize:function(){return this._buffer},write:function(b){if(this._parent)return this._parent.write(b);this._buffer+=b},indent_:function(b,a){this._indentLevel+=1;b.call(a,this);this._indentLevel-=1},newline_:function(){this.write('\n');var b=this._indentLevel;while(b--)this.write('  ')},delimitField_:function(){this.write(this._methodSeparator);this._methodSeparator=','},line_:function(b){this.newline_();this.write(b+';')},input_:function(){return'this._input'},offset_:function(){return'this._offset'},slice_:function(a){var d=this.tempVar_('slice'),f=this.input_(),e=this.offset_();this.if_(f+'.length > '+e,function(b){b.line_(d+' = '+f+'.substring('+e+', '+e+' + '+a+')')});this.else_(function(b){b.line_(d+' = null')});return d},syntaxNode_:function(b,a,d,f,e,c){e=', '+(e||'[]');c=c?', '+c:'';var k=this.tempVar_('klass','this.constructor.SyntaxNode'),h=this.findType_(a),g=', '+this.offset_();this.line_(b+' = new '+k+'('+d+g+e+c+')');this.extendNode_(b,h);this.line_(this.offset_()+' += '+f)},findType_:function(b){if(b)return this.tempVar_('type','find(this.constructor, "'+b+'")');else return this.tempVar_('type','null')},extendNode_:function(a,d){if(!d)return;this.if_('typeof '+d+' === "object"',function(b){b.line_('extend('+a+', '+d+')')})},failure_:function(a,d){this.line_(a+' = null');var f=this.input_(),e=this.offset_(),c=this.slice_(1);var k='this.error = this.constructor.lastError';d=d.replace(/\\/g,'\\\\').replace(/"/g,'\\"');this.if_('!this.error || this.error.offset <= '+e,function(b){b.line_(k+' = {input: '+f+', offset: '+e+', expected: "'+d+'"}')})},namespace_:function(b){var a=b.split('.');this.var_('namespace','this');for(var d=0,f=a.length;d<f-1;d++)this.line_('namespace = namespace.'+a[d]+' = namespace.'+a[d]+' || {}')},closure_:function(b,a){this.write('(function() {');new Canopy.Builder(this).indent_(b,a);this.newline_();this.write('})();');this.newline_();this.newline_()},function_:function(b,a,d,f){this.newline_();this.write(b+' = function('+a.join(', ')+') {');new Canopy.Builder(this).indent_(d,f);this.newline_();this.write('};');this.newline_()},module_:function(b,a,d){this.newline_();this.write(b+' = {');new Canopy.Builder(this).indent_(a,d);this.newline_();this.write('};')},field_:function(b,a){this.delimitField_();this.newline_();this.write(b+': '+a)},method_:function(b,a,d,f){this.delimitField_();this.newline_();this.write(b+': function('+a.join(', ')+') {');this._varIndex={};this.indent_(d,f);this.newline_();this.write('}')},ivar_:function(b,a){this.line_('this._'+b+' = '+a)},var_:function(){for(var b=0,a=arguments.length;b<a;b+=2)this.line_('var '+arguments[b]+' = '+arguments[b+1])},tempVar_:function(b,a){this._varIndex[b]=this._varIndex[b]||0;var d=b+this._varIndex[b];this._varIndex[b]+=1;this.var_(d,(a===undefined)?'null':a);return d},tempVars_:function(b){var a={},d=[],f;for(var e in b){this._varIndex[e]=this._varIndex[e]||0;f=e+this._varIndex[e];this._varIndex[e]+=1;d.push(f+' = '+b[e]);a[e]=f}this.line_('var '+d.join(', '));return a},conditional_:function(b,a,d,f){this.newline_();this.write(b+' ('+a+') {');this.indent_(d,f);this.newline_();this.write('}')},for_:function(b,a,d){this.conditional_('for',b,a,d)},while_:function(b,a,d){this.conditional_('while',b,a,d)},if_:function(b,a,d){this.conditional_('if',b,a,d)},unless_:function(b,a,d){this.conditional_('if','!('+b+')',a,d)},else_:function(b,a){this.write(' else {');this.indent_(b,a);this.newline_();this.write('}')},return_:function(b){this.line_('return '+b)}});Canopy.Compiler=function(b){this._grammarText=b};Canopy.extend(Canopy.Compiler.prototype,{parseTree:function(){if(this._tree)return this._tree;var b=Canopy.MetaGrammarParser,a;this._tree=b.parse(this._grammarText);if(this._tree)return this._tree;a=b.formatError(b.lastError);throw new Error(a);},toSexp:function(b){return this.parseTree().toSexp()},toSource:function(){var b=new Canopy.Builder();this.parseTree().compile(b);return b.serialize()}});Canopy.Compiler.Grammar={grammarName:function(){return this.grammar_name.object_identifier.textValue},toSexp:function(){var a=['grammar',this.grammarName()];this.rules.forEach(function(b){a.push(b.grammar_rule.toSexp())});return a},compile:function(j){j.closure_(function(e){e.line_('var extend = '+Canopy.extend.toString());e.newline_();e.line_('var find = '+Canopy.find.toString());e.newline_();e.line_('var formatError = '+Canopy.formatError.toString());e.newline_();e.module_('var Grammar',function(a){this.rules.forEach(function(b){b.grammar_rule.compile(a)})},this);e.newline_();var c=this.grammarName(),k=this.grammarName()+'Parser',h=/\./.test(c)?c.replace(/\.[^\.]+$/g,'').split('.'):[],g=this.rules.elements[0].grammar_rule.name();e.function_('var Parser',['input'],function(b){b.ivar_('input','input');b.ivar_('offset','0');b.ivar_('nodeCache','{}')});e.function_('Parser.prototype.parse',[],function(a){var d=a.input_(),f=a.offset_();a.var_('result','this.__consume__'+g+'()');a.if_('result && '+f+' === '+d+'.length',function(b){b.return_('result')});a.unless_('this.error',function(b){b.line_('this.error = {input: '+d+', offset: '+f+', expected: "<EOF>"}')});a.var_('message','formatError(this.error)');a.var_('error','new Error(message)');a.line_('throw error')});e.function_('Parser.parse',['input'],function(b){b.var_('parser','new Parser(input)');b.return_('parser.parse()')});e.line_('extend(Parser.prototype, Grammar)');e.newline_();e.function_('var SyntaxNode',['textValue','offset','elements','properties'],function(b){b.line_('this.textValue = textValue');b.line_('this.offset    = offset');b.line_('this.elements  = elements || []');b.line_('if (!properties) return');b.line_('for (var key in properties) this[key] = properties[key]')});e.function_('SyntaxNode.prototype.forEach',['block','context'],function(a){a.for_('var i = 0, n = this.elements.length;i < n;i++',function(b){b.line_('block.call(context, this.elements[i], i)')})});e.line_('Parser.SyntaxNode = SyntaxNode');var i=function(b){b.line_(c+' = Grammar');b.line_(k+' = Parser');b.line_(k+'.formatError = formatError')};var q=h.length,r;if(q>0){r=[];for(var m=0;m<q;m++)r.push('typeof '+h.slice(0,m+1).join('.')+' !== "undefined"');r=r.join(' && ')}e.newline_();e.if_('typeof require === "function" && typeof exports === "object"',function(b){b.line_('exports.Grammar = Grammar');b.line_('exports.Parser  = Parser');b.line_('exports.parse   = Parser.parse');b.newline_();if(r)b.if_(r,i)});e.else_(function(b){b.namespace_(c);i(b)})},this)}};Canopy.Compiler.GrammarRule={name:function(){return this.identifier.textValue},toSexp:function(){return['rule',this.name(),this.parsing_expression.toSexp()]},compile:function(c){var k=this.name();c.method_('__consume__'+k,['input'],function(){var a=c.tempVars_({address:'null',index:c.offset_()}),d=a.address,f=a.index,e='this._nodeCache["'+k+'"]['+f+']';c.line_('this._nodeCache["'+k+'"] = this._nodeCache["'+k+'"] || {}');c.var_('cached',e);c.if_('cached',function(b){b.line_(b.offset_()+' += cached.textValue.length');b.return_('cached')},this);this.parsing_expression.compile(c,d);c.return_(e+' = '+d)},this)}};Canopy.Compiler.Choice={expressions:function(){if(this._expressions)return this._expressions;this._expressions=[this.first_part];this.rest.forEach(function(b){this._expressions.push(b.expression)},this);return this._expressions},toSexp:function(){var a=['choice'];Canopy.forEach(this.expressions(),function(b){a.push(b.toSexp())});return a},compile:function(b,a,d){var f=b.tempVar_('index',b.offset_());this._compileChoices(b,0,a,d,f)},_compileChoices:function(d,f,e,c,k){var h=this.expressions();if(f===h.length)return;h[f].compile(d,e);d.if_(e,function(b){if(c){var a=b.findType_(c);b.extendNode_(e,a)}});d.else_(function(b){b.line_(b.offset_()+' = '+k);this._compileChoices(b,f+1,e,c,k)},this)}};Canopy.Compiler.ChoicePart={nodeType:function(){var b=this.elements[1].type_expression;return b?b.object_identifier.textValue:null},toSexp:function(){var b=this.elements[0].toSexp(),a;if(a=this.nodeType())b=['type',a,b];return b},compile:function(b,a){this.elements[0].compile(b,a,this.nodeType())}};Canopy.Compiler.AnyChar={toSexp:function(){return['any-char']},compile:function(a,d,f){var e=a.tempVar_('temp',a.slice_(1));a.if_(e+' === null',function(b){b.failure_(d,'<any char>')});a.else_(function(b){b.syntaxNode_(d,f,e,1)})}};Canopy.Compiler.CharClass={toSexp:function(){return['char-class',this.textValue]},compile:function(a,d,f){var e='/^'+this.textValue+'/',c=a.slice_(1);a.if_(c+' && '+e+'.test('+c+')',function(b){b.syntaxNode_(d,f,c,1)});a.else_(function(b){b.failure_(d,this.textValue)},this)}};Canopy.Compiler.String={toSexp:function(){return['string',eval(this.textValue)]},compile:function(a,d,f){var e=this.textValue,c=eval(this.textValue).length;a.if_(a.slice_(c)+' === '+e,function(b){b.syntaxNode_(d,f,e,c)});a.else_(function(b){b.failure_(d,this.textValue)},this)}};Canopy.Compiler.CIString={toSexp:function(){return['ci-string',this.stringValue()]},compile:function(a,d,f){var e=this.stringValue(),c=e.length,k=a.tempVar_('temp',a.slice_(c)),h='.toLowerCase()';a.if_(k+h+' === "'+e+'"'+h,function(b){b.syntaxNode_(d,f,k,c)});a.else_(function(b){b.failure_(d,this.textValue)},this)},stringValue:function(){var b='"'+this.elements[1].textValue+'"';return eval(b)}};Canopy.Compiler.Predicate={atomic:function(){var b=this.atom;return b.parsing_expression||b},toSexp:function(){var b=this.atomic(),a={'&':'and','!':'not'},d=a[this.predicate.textValue];return[d,b.toSexp()]},compile:function(a,d,f){var e=a.tempVar_('index',a.offset_()),c={'&':'if_','!':'unless_'},k=c[this.predicate.textValue];this.atomic().compile(a,d);a.line_(a.offset_()+' = '+e);a[k](d,function(b){b.syntaxNode_(d,f,'""',0)});a.else_(function(b){b.line_(d+' = null')})}};Canopy.Compiler.Repeat={QUANTITIES:{'*':0,'+':1},atomic:function(){var b=this.atom;return b.parsing_expression||b},toSexp:function(){var b=this.atomic(),a=b.toSexp();a=b.toSexp();switch(this.quantifier.textValue){case'*':a=['repeat',0,a];break;case'+':a=['repeat',1,a];break;case'?':a=['maybe',a];break}return a},compile:function(d,f,e){var c=this.quantifier.textValue;if(c==='?')return this._compileMaybe(d,f,e);var k=this.QUANTITIES[c],h=d.tempVars_({remaining:k,index:d.offset_(),elements:'[]',text:'""',address:'true'}),g=h.remaining,i=h.index,q=h.elements,r=h.text,m=h.address;d.while_(m,function(a){this.atomic().compile(a,m);a.if_(m,function(b){b.line_(q+'.push('+m+')');b.line_(r+' += '+m+'.textValue');b.line_(g+' -= 1')})},this);d.if_(g+' <= 0',function(b){b.line_(b.offset_()+' = '+i);b.syntaxNode_(f,e,r,r+'.length',q)});d.else_(function(b){b.line_(f+' = null')})},_compileMaybe:function(d,f,e){var c=d.tempVar_('index',d.offset_());this.atomic().compile(d,f);d.if_(f,function(b){if(e){var a=b.findType_(e);b.extendNode_(f,a)}});d.else_(function(b){b.line_(b.offset_()+' = '+c);b.syntaxNode_(f,e,'""',0)})}};Canopy.Compiler.Sequence={expressions:function(){if(this._expressions)return this._expressions;this._expressions=[this.first_part];this.rest.forEach(function(b){this._expressions.push(b.expression)},this);return this._expressions},toSexp:function(){var a=['sequence'];Canopy.forEach(this.expressions(),function(b){a.push(b.toSexp())});return a},compile:function(a,d,f){var e=a.tempVars_({index:a.offset_(),elements:'[]',labelled:'{}',text:'""'});var c=e.index,k=e.elements,h=e.labelled,g=e.text;this._compileExpressions(a,0,c,k,h,g);a.if_(k,function(b){b.line_(b.offset_()+' = '+c);b.syntaxNode_(d,f,g,g+'.length',k,h)});a.else_(function(b){b.line_(d+' = null')})},_compileExpressions:function(a,d,f,e,c,k){var h=this.expressions();if(d===h.length)return;var g=a.tempVar_('address'),i=h[d].label();h[d].compile(a,g);a.if_(g,function(b){b.line_(e+'.push('+g+')');b.line_(k+' += '+g+'.textValue');if(i)b.line_(c+'.'+i+' = '+g);this._compileExpressions(b,d+1,f,e,c,k)},this);a.else_(function(b){b.line_(e+' = null');b.line_(b.offset_()+' = '+f)})}};Canopy.Compiler.SequencePart={atomic:function(){var b=this.expression;return b.parsing_expression||b},label:function(){var b=this.elements[0].identifier,a=this.atomic();if(b)return b.textValue;if(a.referenceName)return a.referenceName();return null},toSexp:function(){var b=this.atomic(),a=this.label(),d=b.toSexp();if(element=this.elements[0].identifier)d=['label',a,d];return d},compile:function(b,a,d){return this.atomic().compile(b,a,d)}};Canopy.Compiler.Reference={referenceName:function(){return this.identifier.textValue},toSexp:function(){return['reference',this.referenceName()]},compile:function(b,a,d){b.line_(a+' = this.__consume__'+this.referenceName()+'()');if(d){var f=b.findType_(d);b.extendNode_(a,f)}}};(function(){for(var b in Canopy.Compiler){if(/^[A-Z]/.test(b))Canopy.MetaGrammarParser[b]=Canopy.Compiler[b]}if(typeof exports==='object'){module.exports=exports;Canopy.extend(exports,Canopy);exports.compile=Canopy.compile}})();
//@ sourceMappingURL=canopy-min.js.map